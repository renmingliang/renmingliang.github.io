(window.webpackJsonp=window.webpackJsonp||[]).push([["onload"],{"23b8":function(e,t,n){"use strict";n.r(t);var a=n("7a23"),c={class:"load-container"},r={class:"stop-tips"},o=function(e){return Object(a.pushScopeId)("data-v-d4295ca2"),e=e(),Object(a.popScopeId)(),e}((function(){return Object(a.createElementVNode)("div",{class:"stop-mask"},null,-1)}));var s=n("9ab4"),i=n("6c02"),u=n("be92"),l=(n("0613"),n("79f6")),d=Object(u.b)({id:"onload",state:function(){return{data:null}},actions:{SET_DATA:function(e){this.data=e},getDatas:function(){return Object(s.b)(this,void 0,void 0,(function(){var e;return Object(s.c)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,l.a.getData()];case 1:return e=t.sent(),this.SET_DATA(e.data),[2,e];case 2:throw t.sent();case 3:return[2]}}))}))}}}),v=n("ac1a"),p=function(){var e=Object(v.a)(),t=Object(u.c)(e).state,n=d(),c=Object(u.c)(n).data,r=function(e,t,n){return new Promise((function(c,r){var o=0,s=e.transaction(t,"readwrite");s.oncomplete=function(){c(o)},s.onerror=function(e){r(e)},s.onabort=function(){};for(var i=s.objectStore(t),u=0,l=n;u<l.length;u++){var d=l[u],v=i.add(Object(a.toRaw)(d));v.onsuccess=function(){o++},v.onerror=function(e){r(e)}}}))};return{deleteDB:function(){window.indexedDB&&window.indexedDB.deleteDatabase(t.value.DBname)},initDB:function(){return new Promise((function(e,n){if(window.indexedDB){var a=window.indexedDB.open(t.value.DBname,t.value.DBver);a.onsuccess=function(a){var o,s,i=a.target.result;Promise.all([r(i,t.value.storeName.award,null===(o=c.value)||void 0===o?void 0:o.type),r(i,t.value.storeName.user,null===(s=c.value)||void 0===s?void 0:s.userData)]).then((function(t){e(t)})).catch((function(e){n(e)}))},a.onerror=function(e){n(e)},a.onupgradeneeded=function(e){var n=e.target.result;n.objectStoreNames.contains(t.value.storeName.user)||n.createObjectStore(t.value.storeName.user,{keyPath:"CompleteID"}),n.objectStoreNames.contains(t.value.storeName.award)||n.createObjectStore(t.value.storeName.award,{autoIncrement:!0})}}else alert("您的浏览器不支持IndexedDB数据库。"),n()}))}}},f=function(e){var t=e.cacheNum,n=d(),c=Object(u.c)(n).data,r=Object(a.ref)(0),o=Object(a.ref)(0),i=Object(a.reactive)({title:"",status:"wait",description:"校验数据是否一致"}),l=Object(a.reactive)({show:!1,tips:"叁"}),v=Object(a.computed)((function(){return{"lottery-stop":!0,show:l.show}}));return{data:c,step:i,stop:l,userNum:o,catchImg:r,classStop:v,preLoadImg:function(){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.c)(this,(function(e){return[2,new Promise((function(e,t){for(var n,a=(null===(n=c.value)||void 0===n?void 0:n.userData)||[],o=0,s=a;o<s.length;o++){var i=s[o],u=new Image;u.src=i.HeadImg,u.addEventListener("load",(function(){r.value++,r.value===a.length&&e(r.value)}),!1),u.addEventListener("error",(function(e){t(e)}),!1)}}))]}))}))},validateData:function(){return new Promise((function(e,n){if(r.value===o.value&&r.value===t.value){i.title="成功",i.status="success",i.description="3秒后进入抽奖页面",l.show=!0;var a=3,c=setInterval((function(){if(2===--a)l.tips="贰";else{if(1!==a)return clearInterval(c),e(a);l.tips="壹"}}),1e3)}else n(new Error("数据校验失败"))}))}}},b={name:"onload",setup:function(){var e=Object(a.ref)(0),t=Object(a.ref)(0),n=d(),c=p(),r=c.deleteDB,o=c.initDB,u=f({cacheNum:t}),l=u.data,v=u.step,b=u.stop,j=u.userNum,m=u.catchImg,O=u.classStop,h=u.preLoadImg,w=u.validateData,g=Object(i.c)();return Object(a.onMounted)((function(){!function(){var a;Object(s.b)(this,void 0,void 0,(function(){var c,i,u;return Object(s.c)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,5,,6]),[4,n.getDatas()];case 1:return s.sent(),j.value=((null===(a=l.value)||void 0===a?void 0:a.userData)||[]).length,e.value=1,r(),[4,o()];case 2:if(c=s.sent(),i=c[0],u=c[1],!i||!u)throw new Error("初始化database失败");return t.value=u,e.value=2,[4,h()];case 3:return s.sent(),e.value=3,[4,w()];case 4:return s.sent(),g.push({path:"/lottery"}),[3,6];case 5:return s.sent(),v.title="失败",v.status="error",v.description="请重新进入或者 刷新本页面",[3,6];case 6:return[2]}}))}))}()})),{activeStep:e,step:v,stop:b,userNum:j,cacheNum:t,catchImg:m,classStop:O}}},j=(n("d728"),n("6b0d"));const m=n.n(j)()(b,[["render",function(e,t,n,s,i,u){var l=Object(a.resolveComponent)("el-step"),d=Object(a.resolveComponent)("el-steps");return Object(a.openBlock)(),Object(a.createElementBlock)("div",c,[Object(a.createVNode)(d,{active:s.activeStep,"finish-status":"success"},{default:Object(a.withCtx)((function(){return[Object(a.createVNode)(l,{title:"数据获取中...",description:"共计获取 "+s.userNum+"条"},null,8,["description"]),Object(a.createVNode)(l,{title:"存储数据中...",description:"共计插入 "+s.cacheNum+"条"},null,8,["description"]),Object(a.createVNode)(l,{title:"缓存头像中...",description:"共计缓存 "+s.catchImg+"张"},null,8,["description"]),Object(a.createVNode)(l,{title:"数据校验"+s.step.title,status:s.step.status,description:s.step.description},null,8,["title","status","description"])]})),_:1},8,["active"]),s.stop.show?(Object(a.openBlock)(),Object(a.createElementBlock)("div",{key:0,class:Object(a.normalizeClass)(s.classStop)},[Object(a.createElementVNode)("div",r,Object(a.toDisplayString)(s.stop.tips),1),o],2)):Object(a.createCommentVNode)("",!0)])}],["__scopeId","data-v-d4295ca2"]]);t.default=m},"52fd":function(e,t,n){},ac1a:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("be92"),c=(n("0613"),n("482f")),r=Object(a.b)({id:"app",state:function(){return{pageTitle:"",state:c.a.state}},getters:{getPageTitle:function(e){return e.pageTitle}},actions:{SET_TITLE:function(e){this.pageTitle=e}}})},d728:function(e,t,n){"use strict";n("52fd")}}]);